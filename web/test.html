<!doctype html>
<html>

<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="style.css">
</head>

<body>

<p>Drag the ball.</p>
<button id="button" onlick="duplicate()">Click me</button>
<img src="https://en.js.cx/clipart/soccer-gate.svg" id="gate" class="droppable">
<img src="https://en.js.cx/clipart/ball.svg" id="ball">
<div id="test">test</div>
<div>test2</div>

<script>
   /* function linedraw(ax,ay,bx,by)
    {
        if(ay>by)
        {
            bx=ax+bx;
            ax=bx-ax;
            bx=bx-ax;
            by=ay+by;
            ay=by-ay;
            by=by-ay;
        }
        var calc=Math.atan((ay-by)/(bx-ax));
        calc=calc*180/Math.PI;
        var length=Math.sqrt((ax-bx)*(ax-bx)+(ay-by)*(ay-by));
        document.body.innerHTML += "<div id='line' style='height:" + length + "px;width:1px;background-color:black;position:absolute;top:" + (ay) + "px;left:" + (ax) + "px;transform:rotate(" + calc + "deg);-ms-transform:rotate(" + calc + "deg);transform-origin:0% 0%;-moz-transform:rotate(" + calc + "deg);-moz-transform-origin:0% 0%;-webkit-transform:rotate(" + calc  + "deg);-webkit-transform-origin:0% 0%;-o-transform:rotate(" + calc + "deg);-o-transform-origin:0% 0%;'></div>"
    }*/
   function createLineElement(x, y, length, angle) {
       var line = document.createElement("div");
       var styles = 'border: 1px solid black; '
           + 'width: ' + length + 'px; '
           + 'height: 0px; '
           + '-moz-transform: rotate(' + angle + 'rad); '
           + '-webkit-transform: rotate(' + angle + 'rad); '
           + '-o-transform: rotate(' + angle + 'rad); '
           + '-ms-transform: rotate(' + angle + 'rad); '
           + 'position: absolute; '
           + 'top: ' + y + 'px; '
           + 'left: ' + x + 'px; ';
       line.setAttribute('style', styles);
       return line;
   }

   function createLine(x1, y1, x2, y2) {
       var a = x1 - x2,
           b = y1 - y2,
           c = Math.sqrt(a * a + b * b);

       var sx = (x1 + x2) / 2,
           sy = (y1 + y2) / 2;

       var x = sx - c / 2,
           y = sy;

       var alpha = Math.PI - Math.atan2(-b, a);

       return createLineElement(x, y, c, alpha);
   }
    var i = 0;
    var ball = document.getElementById('ball');
    function duplicate() {
        var clone = ball.cloneNode(true); // "deep" clone
        clone.id = "duplicetor" + ++i; // there can only be one element with an ID
        ball.parentElement.appendChild(clone);
        //ball.parentNode.appendChild(clone);
        clone.ondragstart = function() {
            return false;
        };
        clone.onmousedown=track;
    }
    document.getElementById('button').onclick = duplicate;





   /* document.addEventListener('click', function(e) {
        e = e || window.event;
        var target = e.target || e.srcElement,
            text = target.textContent || target.innerText;
        //original = target;
        console.log(text);
    }, false);*/
    let currentDroppable = null;



        function track(event) {
        original = event.target;
        let shiftX = event.clientX - original.getBoundingClientRect().left;
        let shiftY = event.clientY - original.getBoundingClientRect().top;


        original.style.position = 'absolute';
        original.style.zIndex = 1000;
        document.body.append(original);

        moveAt(event.pageX, event.pageY);

        function moveAt(pageX, pageY) {
            original.style.left = pageX - shiftX + 'px';
            original.style.top = pageY - shiftY + 'px';
        }

        function onMouseMove(event) {
            moveAt(event.pageX, event.pageY);

            /*original.hidden = true;
            let elemBelow = document.elementFromPoint(event.clientX, event.clientY);
            original.hidden = false;

            if (!elemBelow) return;

            let droppableBelow = elemBelow.closest('.droppable');
            if (currentDroppable != droppableBelow) {
                if (currentDroppable) { // null when we were not over a droppable before this event
                    leaveDroppable(currentDroppable);
                }
                currentDroppable = droppableBelow;
                if (currentDroppable) { // null if we're not coming over a droppable now
                    // (maybe just left the droppable)
                    enterDroppable(currentDroppable);
                }
            }*/
        }

        document.addEventListener('mousemove', onMouseMove);

        original.onmouseup = function() {
            document.removeEventListener('mousemove', onMouseMove);
            original.onmouseup = null;
            document.body.appendChild(createLine(event.clientX,event.clientY,original.getBoundingClientRect().left,original.getBoundingClientRect().top));
            //linedraw(event.clientX,event.clientY,original.getBoundingClientRect().left,original.getBoundingClientRect().top);
        };

    };
    ball.onmousedown = track;
    //document.getElementById('ball').onmousedown = track(event);
    /*let num1 = document.querySelector('#ball');
    num1.addEventListener('mousedown', (e) => {
        console.log('mouse down');
        track(e);
    });*/

    function enterDroppable(elem) {
        elem.style.background = 'pink';
    }

    function leaveDroppable(elem) {
        elem.style.background = '';
    }

    ball.ondragstart = function() {
        return false;
    };
    window.onload = function() {
        var canvas = document.getElementById("myCanvas");
        var ctx = canvas.getContext("2d");
        var img = document.getElementById("ball");
        ctx.drawImage(img, 10, 10);
    };
</script>


</body>
</html>